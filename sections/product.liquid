{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = current_variant.featured_image | default: product.featured_image
%}

<section
  id="{{ section_id }}"
  style="
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  <div class="px-6 pt-3">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
      <!-- Product Images -->
      <div class="space-y-4">
        <div class="aspect-square rounded-xl overflow-hidden bg-neutral-50 border border-neutral-200">
          {% if featured_image %}
            {% render 'image', 
              class: 'w-full h-full object-cover transition-transform duration-300 hover:scale-105', 
              image: featured_image,
              loading: 'eager'
            %}
          {% else %}
            <div class="w-full h-full flex items-center justify-center text-neutral-400">
              <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                <path d="M14.14 11.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/>
              </svg>
            </div>
          {% endif %}
        </div>

        {% if product.images.size > 1 %}
          <div class="flex gap-2 flex-wrap">
            {% for image in product.images limit: 4 %}
              <button 
                class="w-20 h-20 rounded-lg overflow-hidden border-2 border-transparent hover:border-neutral-500 transition-all duration-200 {% if forloop.first %}border-neutral-500 ring-2 ring-neutral-500{% endif %}"
                data-image-id="{{ image.id }}"
                aria-label="View image {{ forloop.index }}"
              >
                {% render 'image', 
                  class: 'w-full h-full object-cover', 
                  image: image,
                  loading: 'lazy'
                %}
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="space-y-3 mr-16">
        <!-- Product Title -->
        <h1 class="text-3xl md:text-4xl font-bold text-neutral-900 leading-tight">{{ product.title }}</h1>

        <!-- Product Price -->
        <div class="flex items-center gap-4">
          {% if current_variant.compare_at_price > current_variant.price %}
            <span class="text-lg text-neutral-500 line-through">
              {{ current_variant.compare_at_price | money }}
            </span>
            <span class="text-2xl font-bold text-neutral-900">
              {{ current_variant.price | money }}
            </span>
            <span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide">
              Sale
            </span>
          {% else %}
            <span class="text-2xl font-bold text-neutral-900">
              {{ current_variant.price | money }}
            </span>
          {% endif %}
        </div>
        {% if product.description != blank %}
            <h3 class="text-lg font-normal text-neutral-500">
                {{ product.type }}
            </h3>
            <div class="text-neutral-600 leading-relaxed">
              {{ product.description }}
          </div>
        {% endif %}

        <!-- Product Form -->
        <div class="space-y-6">
          {% form 'product', product, class: 'space-y-6' %}

            <!-- Quantity Selector -->
            <div class="space-y-2 w-fit">
              <div class="flex items-center border border-neutral-200 rounded-xl overflow-hidden bg-neutral-50 shadow-sm">
                <button 
                  type="button" 
                  class="w-12 h-12 bg-neutral-100 hover:bg-neutral-200 active:bg-neutral-300 border-none text-neutral-700 transition-colors duration-200 flex items-center justify-center"
                  data-quantity-decrease
                  aria-label="Decrease quantity"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"/>
                  </svg>
                </button>
                <input 
                  type="number"
                  id="quantity-input"
                  name="quantity" 
                  min="1" 
                  value="1" 
                  class="w-16 h-12 text-center border-none bg-white text-neutral-900 text-base font-medium focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:ring-inset"
                  style="
                    -webkit-appearance: none;
                    -moz-appearance: textfield;
                    appearance: textfield;
                  "
                  data-quantity-input
                >
                <button 
                  type="button" 
                  class="w-12 h-12 bg-neutral-100 hover:bg-neutral-200 active:bg-neutral-300 border-none text-neutral-700 transition-colors duration-200 flex items-center justify-center"
                  data-quantity-increase
                  aria-label="Increase quantity"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Add to Cart Button -->
            <div class="space-y-4 pt-4">
              <button 
                type="submit" 
                class="w-full bg-neutral-600 hover:bg-neutral-700 disabled:bg-neutral-400 text-white font-semibold py-4 px-8 rounded-lg transition-all duration-200 hover:transform hover:-translate-y-0.5 hover:shadow-lg disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
                {% unless current_variant.available %}disabled="disabled"{% endunless %}
              >
                {% if current_variant.available %}
                  Add to cart
                {% else %}
                  Sold out
                {% endif %}
              </button>
              
              {% if current_variant.available %}
                {{ form | payment_button }}
              {% endif %}
            </div>
          {% endform %}
        
        </div>
      </div>
    </div>
  </div>
</section>

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  // Quantity selector functionality
  const quantityInput = document.querySelector('[data-quantity-input]');
  const decreaseBtn = document.querySelector('[data-quantity-decrease]');
  const increaseBtn = document.querySelector('[data-quantity-increase]');

  if (decreaseBtn && increaseBtn && quantityInput) {
    decreaseBtn.addEventListener('click', function() {
      const currentValue = parseInt(quantityInput.value);
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });

    increaseBtn.addEventListener('click', function() {
      const currentValue = parseInt(quantityInput.value);
      quantityInput.value = currentValue + 1;
    });
  }

  // Variant selector functionality
  const variantSelect = document.querySelector('[data-variant-selector]');
  if (variantSelect) {
    variantSelect.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      const price = selectedOption.dataset.price;
      const comparePrice = selectedOption.dataset.comparePrice;
      const available = selectedOption.dataset.available === 'true';
      
      // Update price display
      const priceElement = document.querySelector('.text-2xl.font-bold.text-neutral-900');
      if (priceElement && price) {
        priceElement.textContent = price;
      }
      
      // Update compare price display
      const comparePriceElement = document.querySelector('.text-lg.text-neutral-500.line-through');
      if (comparePriceElement) {
        if (comparePrice && comparePrice !== price) {
          comparePriceElement.textContent = comparePrice;
          comparePriceElement.style.display = 'inline';
        } else {
          comparePriceElement.style.display = 'none';
        }
      }
      
      // Update add to cart button
      const addToCartBtn = document.querySelector('button[type="submit"]');
      if (addToCartBtn) {
        if (available) {
          addToCartBtn.disabled = false;
          addToCartBtn.textContent = 'Add to cart';
          addToCartBtn.classList.remove('bg-neutral-400', 'cursor-not-allowed');
          addToCartBtn.classList.add('bg-neutral-600', 'hover:bg-neutral-700');
        } else {
          addToCartBtn.disabled = true;
          addToCartBtn.textContent = 'Sold out';
          addToCartBtn.classList.remove('bg-neutral-600', 'hover:bg-neutral-700');
          addToCartBtn.classList.add('bg-neutral-400', 'cursor-not-allowed');
        }
      }
    });
  }

  // Thumbnail image switching
  const thumbnails = document.querySelectorAll('[data-image-id]');
  const mainImage = document.querySelector('.product-main-image__img, .aspect-square img');
  
  thumbnails.forEach(thumbnail => {
    thumbnail.addEventListener('click', function() {
      // Remove active classes from all thumbnails
      thumbnails.forEach(t => {
        t.classList.remove('border-neutral-500', 'ring-2', 'ring-neutral-500');
        t.classList.add('border-transparent');
      });
      
      // Add active classes to clicked thumbnail
      this.classList.remove('border-transparent');
      this.classList.add('border-neutral-500', 'ring-2', 'ring-neutral-500');
      
      // Update main image
      if (mainImage) {
        const thumbnailImg = this.querySelector('img');
        if (thumbnailImg) {
          mainImage.src = thumbnailImg.src;
          mainImage.alt = thumbnailImg.alt;
        }
      }
    });
  });
});
{% endjavascript %}

{% stylesheet %}
/* Remove all browser controls from number input */
#quantity-input {
  -webkit-appearance: none !important;
  -moz-appearance: textfield !important;
  appearance: textfield !important;
  -webkit-inner-spin-button: none !important;
  -webkit-outer-spin-button: none !important;
  -moz-inner-spin-button: none !important;
  -moz-outer-spin-button: none !important;
  margin: 0 !important;
  padding: 0 !important;
  -webkit-box-shadow: none !important;
  -moz-box-shadow: none !important;
  box-shadow: none !important;
  -webkit-border-radius: 0 !important;
  -moz-border-radius: 0 !important;
  border-radius: 0 !important;
}

/* Additional browser-specific overrides */
#quantity-input::-webkit-outer-spin-button,
#quantity-input::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}

#quantity-input::-moz-number-spin-box {
  -moz-appearance: textfield !important;
}

#quantity-input::-ms-clear,
#quantity-input::-ms-expand {
  display: none !important;
}
{% endstylesheet %}

{% schema %}
{
  "name": "Product",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_type",
      "label": "Show Type",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show Tags",
      "default": true
    }
  ]
}
{% endschema %}
